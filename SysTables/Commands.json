{
  "tabletypeflag": "",
  "parenttablename": "",
  "inactive": false,
  "iseditable": true,
  "level": 1,
  "issystemtable": true,
  "tabletype": "טבלת מערכת",
  "title": "Mobile Commands",
  "tablename": "Commands",
  "primarykey": "Commands",
  "ngv_modifydate": "2025-07-21T15:11:45.258816",
  "ngv_hashcode": "",
  "noskip": null,
  "priformname": null,
  "enforcebpm": null,
  "chk": null,
  "curlangtitle": "פקודות (נייד)",
  "istrackchanges": null,
  "testadd": null,
  "SysTableConds": [],
  "SysTableFromEnts": [],
  "SysTablesConts": [],
  "SysServerIndexes": [],
  "SysTableOrgConds": [
    {
      "text": "SELECT\n    c.PrimaryKey AS EntityID,\n    ua.Username AS UserID,\n    ua.ApplicationCode\nFROM\n    Commands c\nJOIN UserApplications ua ON 1 = 1\nJOIN NgvUsers nu ON nu.Username = ua.Username AND nu.Active = true\nLEFT JOIN SysTables st ON c.TargetTableName = st.TableName\nLEFT JOIN SysEntities se ON se.EntityName = c.TargetEntityName\nLEFT JOIN SysTableTypes ttype ON st.TableType = ttype.PrimaryKey\nWHERE\n    \n    c.TargetTableName IS NULL\n\nUNION\n\n-- Case 2: Table level > 1 (always grant access)\nSELECT\n    c.PrimaryKey AS EntityID,\n    ua.Username AS UserID,\n    ua.ApplicationCode\nFROM\n    Commands c\nJOIN UserApplications ua ON 1 = 1\nJOIN NgvUsers nu ON nu.Username = ua.Username AND nu.Active = true\nLEFT JOIN SysTables st ON c.TargetTableName = st.TableName\nLEFT JOIN SysEntities se ON se.EntityName = c.TargetEntityName\nLEFT JOIN SysTableTypes ttype ON st.TableType = ttype.PrimaryKey\nWHERE\n    \n    c.TargetTableName IS NOT NULL\n    AND COALESCE(st.Level, 0) > 1\n\nUNION\n\n-- Case 3: Admin user (always grant access)\nSELECT\n    c.PrimaryKey AS EntityID,\n    ua.Username AS UserID,\n    ua.ApplicationCode\nFROM\n    Commands c\nJOIN UserApplications ua ON 1 = 1\nJOIN NgvUsers nu ON nu.Username = ua.Username AND nu.Active = true\nLEFT JOIN SysTables st ON c.TargetTableName = st.TableName\nLEFT JOIN SysEntities se ON se.EntityName = c.TargetEntityName\nLEFT JOIN SysTableTypes ttype ON st.TableType = ttype.PrimaryKey\nWHERE\n \n     exists (\n        SELECT 1\n        FROM UserParams\n        WHERE UserName = ua.Username\n        AND UserAttributeName = 'IsAdmin'\n        AND value = 'true'\n    ) \n\nUNION\n\n-- Case 4: Developer user\nSELECT\n    c.PrimaryKey AS EntityID,\n    ua.Username AS UserID,\n    ua.ApplicationCode\nFROM\n    Commands c\nJOIN UserApplications ua ON 1 = 1\nJOIN NgvUsers nu ON nu.Username = ua.Username AND nu.Active = true\nLEFT JOIN SysTables st ON c.TargetTableName = st.TableName\nLEFT JOIN SysEntities se ON se.EntityName = c.TargetEntityName\nLEFT JOIN SysTableTypes ttype ON st.TableType = ttype.PrimaryKey\nWHERE\n \n    c.TargetTableName IS NOT NULL\n    AND COALESCE(st.Level, 1) = 1\n    AND (\n        exists(\n            SELECT 1\n            FROM UserParams\n            WHERE UserName = ua.Username\n              AND UserAttributeName = 'IsDeveloper'\n              AND Value = 'true'\n        ) \n        AND (\n            se.EntityType NOT IN ('P', 'L')\n            or (se.TableName LIKE 'Sys%'\n            OR ttype.PrimaryKey IN ('-12', '-13', '-2', '-1')))\n        \n    )\n\nUNION\n\n-- Case 5: Regular user\nSELECT\n    c.PrimaryKey AS EntityID,\n    ua.Username AS UserID,\n    ua.ApplicationCode\nFROM\n    Commands c\nJOIN UserApplications ua ON 1 = 1\nJOIN NgvUsers nu ON nu.Username = ua.Username AND nu.Active = true\nLEFT JOIN SysTables st ON c.TargetTableName = st.TableName\nLEFT JOIN SysEntities se ON se.EntityName = c.TargetEntityName\nLEFT JOIN SysTableTypes ttype ON st.TableType = ttype.PrimaryKey\nWHERE\n \n    c.TargetTableName IS NULL\n    AND COALESCE(st.Level, 1) = 1\n    AND se.EntityType IS NOT NULL\n    AND (\n        -- Case A: Command opens a list (EntityType <> 'P') - any role privilege\n        (se.EntityType <> 'P' AND EXISTS (\n            SELECT 1\n            FROM RolePrivileges rp\n            JOIN UserRoles ur ON ur.Role = rp.Role\n            WHERE ur.Username = ua.Username\n            AND rp.TableName = c.TargetTableName\n        ))\n        -- Case B: Command opens a page with CommandType in (4, 10, 17, 24) - requires editing privilege\n        OR (\n            se.EntityType = 'P'\n            AND c.CommandType IN (4, 10, 17, 24)\n            AND EXISTS (\n                SELECT 1\n                FROM RolePrivileges rp\n                JOIN UserRoles ur ON ur.Role = rp.Role\n                WHERE ur.Username = ua.Username\n                  AND rp.TableName = c.TargetTableName\n                  AND rp.Editing = true\n            )\n        )\n        -- Case C: Command opens a page with CommandType NOT in (4, 10, 17, 24) - any role privilege\n        OR (\n            se.EntityType = 'P'\n            AND c.CommandType NOT IN (4, 10, 17, 24)\n            AND EXISTS (\n                SELECT 1\n                FROM RolePrivileges rp\n                JOIN UserRoles ur ON ur.Role = rp.Role\n                WHERE ur.Username = ua.Username\n                  AND rp.TableName = c.TargetTableName\n            )\n        )\n    )",
      "primarykey": "Commands",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-07-21T15:11:45.182384",
      "ngv_hashcode": "",
      "ord": 0
    }
  ],
  "SysTableColumns": [
    {
      "name": "CommandTitle",
      "title": "Title",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 22,
      "primarykey": "Commands:CommandTitle",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "כותרת",
      "type": "Str",
      "iseditable": true,
      "maxwidth": 48,
      "transferchanges": true,
      "SysTableColumnQuery": []
    },
    {
      "name": "Icon",
      "title": "Title",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 52,
      "primarykey": "Commands:Icon",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "שם אייקון",
      "type": "Str",
      "iseditable": true,
      "maxwidth": 20,
      "transferchanges": true,
      "SysTableColumnQuery": []
    },
    {
      "name": "CommandName",
      "title": "Title",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 12,
      "primarykey": "Commands:CommandName",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "שם פקודה",
      "type": "Str",
      "iseditable": true,
      "maxwidth": 20,
      "transferchanges": true,
      "SysTableColumnQuery": []
    },
    {
      "name": "NextCmd",
      "title": "Command For Continuation",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 72,
      "primarykey": "Commands:NextCmd",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "פקודת המשך",
      "type": "Str",
      "iseditable": true,
      "maxwidth": 20,
      "transferchanges": true,
      "SysTableColumnQuery": []
    },
    {
      "name": "TargetEntityName",
      "title": "Title",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 42,
      "primarykey": "Commands:TargetEntityName",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "ישות יעד",
      "type": "Str",
      "iseditable": true,
      "maxwidth": 20,
      "transferchanges": true,
      "SysTableColumnQuery": []
    },
    {
      "name": "TargetTableName",
      "title": "Title",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 32,
      "primarykey": "Commands:TargetTableName",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "טבלת מקור",
      "type": "Str",
      "iseditable": true,
      "maxwidth": 20,
      "transferchanges": true,
      "SysTableColumnQuery": []
    },
    {
      "name": "CommandType",
      "title": "Title",
      "isboolean": false,
      "isicon": false,
      "isid": false,
      "latitude": false,
      "longitude": false,
      "colorder": 62,
      "primarykey": "Commands:CommandType",
      "fatherkey": "Commands",
      "ngv_modifydate": "2025-06-24T06:20:01.012898",
      "ngv_hashcode": "",
      "isurl": null,
      "isfiledesc": null,
      "currentlangtitle": "סוג פקודה (ID)",
      "type": "Int",
      "iseditable": true,
      "maxwidth": 3,
      "transferchanges": true,
      "SysTableColumnQuery": []
    }
  ],
  "SysPermissionDependencies": []
}
GGGD